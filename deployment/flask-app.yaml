---
apiVersion: v1
kind: Pod
metadata:
  name: flask-app
  namespace: flask-app
  labels:
    name: flask-app
spec:
  containers:
    - name: flask-app
      image: astanil/flask:latest
      imagePullPolicy: Always
      resources:
        limits:
          cpu: 200m
          memory: 512Mi
      command: ["python"]
      args: ["-m", "flask-app", "run", "-h", "0.0.0.0"]
      env:
        - name: FLASK_APP
          value: api.py
        - name: FLASK_ENVIRONMENT
          value: development
        - name: MYSQL_USER
          value: user
        - name: MYSQL_PASSWORD
          valueFrom:
            secretKeyRef:
              name: mysql-secret
              key: mysql-password
        - name: MYSQL_DATABASE
          valueFrom:
             configMapKeyRef:
              name: mysql-config
              key: mysql-db-name
        - name: MYSQL_HOSTNAME
          value: mysql.default.svc
      ports:
        - containerPort: 5000
          name: flask
      startupProbe:
        httpGet:
          path: /api/heath-check/ok
          port: flask
        failureThreshold: 3
        periodSeconds: 3
